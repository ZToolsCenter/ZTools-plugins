import{O as k,F as V,K as J,S as K,y as R,b as U}from"./index-4d792b2f.js";import{E as L}from"./overlay-64b767d0.js";import{E as W,c as j,a as q}from"./input-7f8edfb4.js";import{f as C,r as x,a as G,q as H,h as g,S as v,U as s,W as a,u as i,ao as B,k as m,t as N,a9 as w,K as O,c as Q,i as S,m as E,j as $,v as T,l as X,af as Y,ag as Z,z as ee,L as te}from"./vue-5f6c84d3.js";import{E as oe}from"./index-82cfccb5.js";import{c as D,a as ne,b as se}from"./radio-button-703f9cfa.js";import"./tools-8f8edc89.js";import"./index-71ce9d2a.js";const F=C({__name:"CatInput",props:{pid:{default:""},preCid:{default:""}},setup(h){const c=h,u=k(),l=x(),n=G({_id:"",pid:c.pid,label:"",tabPosition:"top",children:[]}),d=(e,r)=>{r&&r.validate(p=>{if(p)f(),e.target.blur(),_(r);else return!1})},_=e=>{e&&e.resetFields()},f=()=>{const e=JSON.parse(JSON.stringify(n));e._id="cat_"+new Date().getTime(),c.pid?u.addCat(e,c.preCid):u.addChildrenCat(e,c.preCid),_(l.value)};return H(()=>{_(l.value)}),(e,r)=>{const p=oe,t=W,o=j;return g(),v(o,{ref_key:"refCatForm",ref:l,model:i(n),"status-icon":!0},{default:s(()=>[a(t,{class:"mb-0!",prop:"label",label:"","inline-message":!0,rules:[{required:!0,message:"分类名称不能为空",trigger:"change"}]},{default:s(()=>[a(p,{class:"mb-1 rounded-10px shadow-sm",size:"large",modelValue:i(n).label,"onUpdate:modelValue":r[0]||(r[0]=b=>i(n).label=b),placeholder:"输入分类名，回车提交！",onKeydown:r[1]||(r[1]=B(b=>d(b,i(l)),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),ae=m("i",{class:"iconfont icon-add text-13px"},null,-1),le={class:"block mb-3"},re=C({__name:"BtnAddCat",props:{pid:{default:""},preCid:{default:""}},setup(h){return(c,u)=>{const l=V,n=F,d=D;return g(),v(d,{width:260,"hide-after":0,persistent:!1,trigger:"click"},{reference:s(()=>[a(l,{class:"border-0",type:"primary",size:"small",plain:"",circle:""},{default:s(()=>[ae]),_:1})]),default:s(()=>[m("span",le,N(c.pid?"追加分类":"添加子分类"),1),a(n,{preCid:c.preCid,pid:c.pid},null,8,["preCid","pid"])]),_:1})}}}),ie=m("i",{class:"iconfont icon-tab text-14px"},null,-1),ce=m("span",{class:"block mb-3"},"二级Tabs位置：",-1),de=C({__name:"BtnOpCat",props:{cat:{}},setup(h){const u=h.cat,l=n=>{const d=utools.db.get(u._id);d&&(d.tabPosition=n,utools.db.put(d))};return(n,d)=>{const _=V,f=ne,e=se,r=D;return g(),v(r,{width:216,"hide-after":0,persistent:!1,trigger:"click"},{reference:s(()=>[a(_,{class:"border-0",type:"success",size:"small",plain:"",circle:""},{default:s(()=>[ie]),_:1})]),default:s(()=>[ce,a(e,{class:"tab-position",modelValue:i(u).tabPosition,"onUpdate:modelValue":d[0]||(d[0]=p=>i(u).tabPosition=p),onChange:l},{default:s(()=>[a(f,{label:"left"},{default:s(()=>[w("左")]),_:1}),a(f,{label:"right"},{default:s(()=>[w("右")]),_:1}),a(f,{label:"top"},{default:s(()=>[w("上")]),_:1}),a(f,{label:"bottom"},{default:s(()=>[w("下")]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});const pe={class:"cat-item-content flex-y-center cursor-move"},ue={key:1,class:"iconfont icon-drag text-muted mr-3 text-14px"},_e=["textContent"],me={class:"op-btns ml-auto"},fe=m("i",{class:"iconfont icon-delete text-13px"},null,-1),be=C({__name:"NestCatItem",props:{cat:{}},setup(h){const c=h,u=J(),l=k(),n=x(!0),d=x(null),_=O("isMaskClose"),f=t=>{t.preventDefault(),t.target.blur()},e=(t,o)=>{t.preventDefault();const b=t.target;if(!b.innerText){u.changeMessage("分类名称不能为空","error"),b.focus(),_.value=!1;return}o.label=b.innerText,l.updateCat(JSON.parse(JSON.stringify(o))),_.value=!0},r=t=>{var o;((o=t==null?void 0:t.children)==null?void 0:o.length)>0&&t.children.forEach(b=>{l.removeCat(b._id)}),l.removeCat(t._id)},p=Q(()=>u.allWebs.filter(o=>o.catIds.includes(c.cat._id)).length);return(t,o)=>{const b=de,P=re,A=V,z=q,I=M;return g(),S("li",{class:E(["cat-item",{"has-children":t.cat.children.length>0}])},[m("div",pe,[!t.cat.pid&&t.cat.children.length>0?(g(),S("i",{key:0,class:E(["iconfont icon-totop text-muted mr-3 text-14px cursor-pointer",i(n)?"rotate-180":"rotate-90"]),onClick:o[0]||(o[0]=y=>n.value=!i(n))},null,2)):(g(),S("i",ue)),m("div",{class:"cursor-text border-0 outline-none px-2 select-all",ref_key:"refCatTitle",ref:d,contenteditable:"true",spellcheck:"false",textContent:N(t.cat.label),onKeydown:o[1]||(o[1]=B(y=>f(y),["enter"])),onBlur:o[2]||(o[2]=y=>e(y,t.cat))},null,40,_e),$(m("span",{class:"text-muted text-12px"},N(i(p)),513),[[T,i(p)>0]]),m("div",me,[t.cat.pid?X("",!0):(g(),v(b,{key:0,cat:t.cat},null,8,["cat"])),a(P,{preCid:t.cat._id,pid:t.cat.pid},null,8,["preCid","pid"]),a(z,{title:"删除该分类将会：1、如果有子分类会连同一起删除，2、分类中的卡片将被移到废纸篓","confirm-button-text":"删吧","cancel-button-text":"算了","hide-after":0,width:"300",onConfirm:o[3]||(o[3]=y=>r(t.cat))},{reference:s(()=>[a(A,{class:"border-0",type:"danger",size:"small",plain:"",circle:""},{default:s(()=>[fe]),_:1})]),_:1})])]),$(a(I,{children:t.cat.children,class:E({"dragArea-has-web":i(p)>0})},null,8,["children","class"]),[[T,i(n)]])],2)}}}),M=C({__name:"NestedDraggable",props:{children:{}},setup(h){const c=k(),{category:u}=c,l=Y(()=>K(()=>import("./vuedraggable.umd-35f24fd1.js").then(e=>e.v),["./vuedraggable.umd-35f24fd1.js","./index-4d792b2f.js","./vue-5f6c84d3.js","./tools-8f8edc89.js","./index-d3e98782.css"],import.meta.url)),n=x(!0),d={name:"gCats",put:e=>!e.el.classList.contains("dragArea-has-web"),pull:e=>!n.value},_=e=>{e.item.classList.contains("has-children")?n.value=!0:n.value=!1};function f(e){if(e.added){const r=u.find(t=>t.children.some(o=>o._id===e.added.element._id));r?e.added.element.pid=r._id:e.added.element.pid="";const p=JSON.parse(JSON.stringify(e.added.element));c.updateCat(p)}}return(e,r)=>(g(),v(i(l),{class:"dragArea",tag:"ul",list:e.children,"ghost-class":"ghost",group:d,"item-key":"_id",onChange:f,onStart:_},{item:s(({element:p})=>[a(be,{cat:p},null,8,["cat"])]),_:1},8,["list"]))}});const ge=m("span",{class:"rounded-full flex-center w-9 h-9 mr-2",style:{"background-color":"var(--el-color-primary-light-9)"}},[m("i",{class:"iconfont icon-cat text-20px",style:{color:"var(--el-color-primary)"}})],-1),he=m("span",{class:"el-dialog__title"},"分类管理",-1),Ce=m("i",{class:"iconfont icon-help text-muted ml-auto"},null,-1),Ve=C({__name:"CatModal",setup(h){const c=k(),{category:u}=Z(c),l=O("showCatModal"),n=x(!0);return ee("isMaskClose",n),(d,_)=>{const f=R,e=F,r=M,p=U,t=L;return g(),v(t,{modelValue:i(l),"onUpdate:modelValue":_[0]||(_[0]=o=>te(l)?l.value=o:null),width:"56%",title:"管理分类","append-to-body":!0,"show-close":!1,"close-on-click-modal":i(n),"close-on-press-escape":i(n),"align-center":!0,draggable:""},{header:s(()=>[ge,he,a(f,{"popper-class":"tooltip max-w-70 py-3 pl-5",content:"注意：1、一级分类下如果有卡片，将无法拖动到其他二级分类中。2、有子分类的一级分类，也无法拖动到其他二级分类中。3、鼠标垂直上下拖动-平级排序，鼠标斜向右拖动可以很轻易拖入二级分类中。"},{default:s(()=>[Ce]),_:1})]),default:s(()=>[a(e,{class:"pb-2",pid:"root"}),a(p,{"max-height":"320px","wrap-class":"pr-3"},{default:s(()=>[a(r,{children:i(u)},null,8,["children"])]),_:1})]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape"])}}});export{Ve as default};
