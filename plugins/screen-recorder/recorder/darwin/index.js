"use strict";const path=require("path"),fs=require("node:fs"),cp=require("child_process"),os=require("os"),BIN=path.join(__dirname.replace(/([a-f0-9]{32}.asar)\//,"$1.unpacked/"),"aperture");function capture(r,e,t,o,n,s){let i;const c=new Promise((c,a)=>{if(parseInt(os.release().split(".")[0],10)<22)return void a(new Error("not supported"));const p={mode:String(r),destination:"file://"+s,showCursor:n,screenId:1===r?e:0,recordSystemAudio:Boolean(t),microphoneDeviceID:o||null};if(3===r?(p.targetID=String(e.displayId),p.cropRect=[[e.x,e.y],[e.width,e.height]]):p.targetID=String(e),!fs.existsSync(BIN))throw new Error("bin 文件已丢失，请重新安装该插件应用");i=cp.spawn(BIN,["record",JSON.stringify(p)]),i.stderr.on("data",r=>{a(new Error(r)),i.kill()}),i.on("exit",(r,e)=>{0===r||null===r?c():a(new Error("异常退出"))}),i.on("error",r=>{a(r)})});return c.quit=()=>{i&&i.kill()},c}fs.access(BIN,fs.constants.X_OK,r=>{if(r)try{fs.chmodSync(BIN,493)}catch{}}),module.exports=capture;