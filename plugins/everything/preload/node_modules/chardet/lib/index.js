"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r=e(t),s=0;s<r.length;s++)"default"!==r[s]&&__createBinding(n,t,r[s]);return __setModuleDefault(n,t),n}}(),__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.detectFileSync=exports.detectFile=exports.analyse=exports.detect=void 0;const node_1=__importDefault(require("./fs/node")),ascii_1=__importDefault(require("./encoding/ascii")),utf8_1=__importDefault(require("./encoding/utf8")),unicode=__importStar(require("./encoding/unicode")),mbcs=__importStar(require("./encoding/mbcs")),sbcs=__importStar(require("./encoding/sbcs")),iso2022=__importStar(require("./encoding/iso2022")),utils_1=require("./utils"),recognisers=[new utf8_1.default,new unicode.UTF_16BE,new unicode.UTF_16LE,new unicode.UTF_32BE,new unicode.UTF_32LE,new mbcs.sjis,new mbcs.big5,new mbcs.euc_jp,new mbcs.euc_kr,new mbcs.gb_18030,new iso2022.ISO_2022_JP,new iso2022.ISO_2022_KR,new iso2022.ISO_2022_CN,new sbcs.ISO_8859_1,new sbcs.ISO_8859_2,new sbcs.ISO_8859_5,new sbcs.ISO_8859_6,new sbcs.ISO_8859_7,new sbcs.ISO_8859_8,new sbcs.ISO_8859_9,new sbcs.windows_1251,new sbcs.windows_1256,new sbcs.KOI8_R,new ascii_1.default],detect=e=>{const t=(0,exports.analyse)(e);return t.length>0?t[0].name:null};exports.detect=detect;const analyse=e=>{if(!(0,utils_1.isByteArray)(e))throw new Error("Input must be a byte array, e.g. Buffer or Uint8Array");const t=[];for(let e=0;e<256;e++)t[e]=0;for(let n=e.length-1;n>=0;n--)t[255&e[n]]++;let n=!1;for(let e=128;e<=159;e+=1)if(0!==t[e]){n=!0;break}const r={byteStats:t,c1Bytes:n,rawInput:e,rawLen:e.length,inputBytes:e,inputLen:e.length};return recognisers.map((e=>e.match(r))).filter((e=>!!e)).sort(((e,t)=>t.confidence-e.confidence))};exports.analyse=analyse;const detectFile=(e,t={})=>new Promise(((n,r)=>{let s;const i=(0,node_1.default)(),c=(e,t)=>{s&&i.closeSync(s),e?r(e):n((0,exports.detect)(t))};if(t&&t.sampleSize){s=i.openSync(e,"r");const n=Buffer.allocUnsafe(t.sampleSize);i.read(s,n,0,t.sampleSize,t.offset,(e=>{c(e,n)}))}else i.readFile(e,c)}));exports.detectFile=detectFile;const detectFileSync=(e,t={})=>{const n=(0,node_1.default)();if(t&&t.sampleSize){const r=n.openSync(e,"r"),s=Buffer.allocUnsafe(t.sampleSize);return n.readSync(r,s,0,t.sampleSize,t.offset),n.closeSync(r),(0,exports.detect)(s)}return(0,exports.detect)(n.readFileSync(e))};exports.detectFileSync=detectFileSync,exports.default={analyse:exports.analyse,detect:exports.detect,detectFileSync:exports.detectFileSync,detectFile:exports.detectFile};