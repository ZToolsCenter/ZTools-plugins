"use strict";var Buffer=require("safer-buffer").Buffer;function Utf16BECodec(){}function Utf16BEEncoder(){}function Utf16BEDecoder(){this.overflowByte=-1}function Utf16Codec(t,e){this.iconv=e}function Utf16Encoder(t,e){void 0===(t=t||{}).addBOM&&(t.addBOM=!0),this.encoder=e.iconv.getEncoder("utf-16le",t)}function Utf16Decoder(t,e){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=t||{},this.iconv=e.iconv}function detectEncoding(t,e){var i=[],o=0,n=0,r=0;t:for(var f=0;f<t.length;f++)for(var c=t[f],d=0;d<c.length;d++)if(i.push(c[d]),2===i.length){if(0===o){if(255===i[0]&&254===i[1])return"utf-16le";if(254===i[0]&&255===i[1])return"utf-16be"}if(0===i[0]&&0!==i[1]&&r++,0!==i[0]&&0===i[1]&&n++,i.length=0,++o>=100)break t}return r>n?"utf-16be":r<n?"utf-16le":e||"utf-16le"}exports.utf16be=Utf16BECodec,Utf16BECodec.prototype.encoder=Utf16BEEncoder,Utf16BECodec.prototype.decoder=Utf16BEDecoder,Utf16BECodec.prototype.bomAware=!0,Utf16BEEncoder.prototype.write=function(t){for(var e=Buffer.from(t,"ucs2"),i=0;i<e.length;i+=2){var o=e[i];e[i]=e[i+1],e[i+1]=o}return e},Utf16BEEncoder.prototype.end=function(){},Utf16BEDecoder.prototype.write=function(t){if(0==t.length)return"";var e=Buffer.alloc(t.length+1),i=0,o=0;for(-1!==this.overflowByte&&(e[0]=t[0],e[1]=this.overflowByte,i=1,o=2);i<t.length-1;i+=2,o+=2)e[o]=t[i+1],e[o+1]=t[i];return this.overflowByte=i==t.length-1?t[t.length-1]:-1,e.slice(0,o).toString("ucs2")},Utf16BEDecoder.prototype.end=function(){this.overflowByte=-1},exports.utf16=Utf16Codec,Utf16Codec.prototype.encoder=Utf16Encoder,Utf16Codec.prototype.decoder=Utf16Decoder,Utf16Encoder.prototype.write=function(t){return this.encoder.write(t)},Utf16Encoder.prototype.end=function(){return this.encoder.end()},Utf16Decoder.prototype.write=function(t){if(!this.decoder){if(this.initialBufs.push(t),this.initialBufsLen+=t.length,this.initialBufsLen<16)return"";var e=detectEncoding(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(e,this.options);for(var i="",o=0;o<this.initialBufs.length;o++)i+=this.decoder.write(this.initialBufs[o]);return this.initialBufs.length=this.initialBufsLen=0,i}return this.decoder.write(t)},Utf16Decoder.prototype.end=function(){if(!this.decoder){var t=detectEncoding(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(t,this.options);for(var e="",i=0;i<this.initialBufs.length;i++)e+=this.decoder.write(this.initialBufs[i]);var o=this.decoder.end();return o&&(e+=o),this.initialBufs.length=this.initialBufsLen=0,e}return this.decoder.end()};