(function(p){var T=typeof window=="object"&&!!window.document,g=T?window:Object,u=g.Recorder,w=u.i18n;p(u,w,w.$T,T)})(function(p,T,g,u){var w=function(a){return new P(a)},m="WaveView",P=function(a){var r=this,i={scale:2,speed:9,phase:21.8,fps:20,keep:!0,lineWidth:3,linear1:[0,"rgba(150,96,238,1)",.2,"rgba(170,79,249,1)",1,"rgba(53,199,253,1)"],linear2:[0,"rgba(209,130,255,0.6)",1,"rgba(53,199,255,0.6)"],linearBg:[0,"rgba(255,255,255,0.2)",1,"rgba(54,197,252,0.2)"]};for(var e in a)i[e]=a[e];r.set=a=i;var h="compatibleCanvas";if(a[h])var n=r.canvas=a[h];else{if(!u)throw new Error(g.G("NonBrowser-1",[m]));var t=a.elem;t&&(typeof t=="string"?t=document.querySelector(t):t.length&&(t=t[0])),t&&(a.width=t.offsetWidth,a.height=t.offsetHeight);var v=r.elem=document.createElement("div");v.style.fontSize=0,v.innerHTML='<canvas style="width:100%;height:100%;"/>';var n=r.canvas=v.querySelector("canvas");t&&(t.innerHTML="",t.appendChild(v))}var o=a.scale,s=a.width*o,c=a.height*o;if(!s||!c)throw new Error(g.G("IllegalArgs-1",[m+" width=0 height=0"]));n.width=s,n.height=c;var l=r.ctx=n.getContext("2d");r.linear1=r.genLinear(l,s,a.linear1),r.linear2=r.genLinear(l,s,a.linear2),r.linearBg=r.genLinear(l,c,a.linearBg,!0),r._phase=0};P.prototype=w.prototype={genLinear:function(a,r,i,e){for(var h=a.createLinearGradient(0,0,e?0:r,e?r:0),n=0;n<i.length;)h.addColorStop(i[n++],i[n++]);return h},genPath:function(a,r,i){for(var e=[],h=this,n=h.set,t=n.scale,v=n.width*t,o=n.height*t/2,s=0;s<=v;s+=t){var c=(1+Math.cos(Math.PI+s/v*2*Math.PI))/2,l=c*o*r*Math.sin(2*Math.PI*(s/v)*a+i)+o;e.push(l)}return e},input:function(a,r,i){var e=this;e.sampleRate=i,e.pcmData=a,e.pcmPos=0,e.inputTime=Date.now(),e.schedule()},schedule:function(){var a=this,r=a.set,i=Math.floor(1e3/r.fps);a.timer||(a.timer=setInterval(function(){a.schedule()},i));var e=Date.now(),h=a.drawTime||0;if(!(e-h<i)){a.drawTime=e;for(var n=a.sampleRate/r.fps,t=a.pcmData,v=a.pcmPos,o=Math.max(0,Math.min(n,t.length-v)),s=0,c=0;c<o;c++,v++)s+=Math.abs(t[v]);a.pcmPos=v,(o||!r.keep)&&a.draw(p.PowerLevel(s,o)),!o&&e-a.inputTime>1300&&(clearInterval(a.timer),a.timer=0)}},draw:function(a){var r=this,i=r.set,e=r.ctx,h=i.scale,n=i.width*h,t=i.height*h,v=i.speed/i.fps,o=r._phase-=v,s=o+v*i.phase,c=a/100,l=r.genPath(2,c,o),b=r.genPath(1.8,c,s);e.clearRect(0,0,n,t),e.beginPath();for(var d=0,f=0;f<=n;d++,f+=h)f==0?e.moveTo(f,l[d]):e.lineTo(f,l[d]);d--;for(var f=n-1;f>=0;d--,f-=h)e.lineTo(f,b[d]);e.closePath(),e.fillStyle=r.linearBg,e.fill(),r.drawPath(b,r.linear2),r.drawPath(l,r.linear1)},drawPath:function(a,r){var i=this,e=i.set,h=i.ctx,n=e.scale,t=e.width*n;h.beginPath();for(var v=0,o=0;o<=t;v++,o+=n)o==0?h.moveTo(o,a[v]):h.lineTo(o,a[v]);h.lineWidth=e.lineWidth*n,h.strokeStyle=r,h.stroke()}},p[m]=w});
