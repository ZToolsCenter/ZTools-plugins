function Ue(q,ne){for(var V=0;V<ne.length;V++){const K=ne[V];if(typeof K!="string"&&!Array.isArray(K)){for(const X in K)if(X!=="default"&&!(X in q)){const ee=Object.getOwnPropertyDescriptor(K,X);ee&&Object.defineProperty(q,X,ee.get?ee:{enumerable:!0,get:()=>K[X]})}}}return Object.freeze(Object.defineProperty(q,Symbol.toStringTag,{value:"Module"}))}function Fe(q){return q&&q.__esModule&&Object.prototype.hasOwnProperty.call(q,"default")?q.default:q}var ye={exports:{}},Re;function $e(){return Re||(Re=1,function(q){(function(ne){var V=typeof window=="object"&&!!window.document,K=V?window:Object;ne(K,V),q.exports&&(q.exports=K.Recorder)})(function(ne,V){var K=function(){},X=function(r){return typeof r=="number"},ee=function(r){return JSON.stringify(r)},s=function(r){return new Oe(r)},de=s.LM="2025-01-11 09:28",pe="https://github.com/xiangyuecn/Recorder",H="Recorder",Y="getUserMedia",le="srcSampleRate",F="sampleRate",Ce="bitRate",me="catch",ie=ne[H];if(ie&&ie.LM==de){ie.CLog(ie.i18n.$T("K8zP::重复导入{1}",0,H),3);return}s.IsOpen=function(){var r=s.Stream;if(r){var t=be(r),e=t[0];if(e){var n=e.readyState;return n=="live"||n==e.LIVE}}return!1},s.BufferSize=4096,s.Destroy=function(){L(H+" Destroy"),ve();for(var r in _e)_e[r]()};var _e={};s.BindDestroy=function(r,t){_e[r]=t},s.Support=function(){if(!V)return!1;var r=navigator.mediaDevices||{};return r[Y]||(r=navigator,r[Y]||(r[Y]=r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia)),!(!r[Y]||(s.Scope=r,!s.GetContext()))},s.GetContext=function(r){if(!V)return null;var t=window.AudioContext;if(t||(t=window.webkitAudioContext),!t)return null;var e=s.Ctx,n=0;return e||(e=s.Ctx=new t,n=1,s.NewCtxs=s.NewCtxs||[],s.BindDestroy("Ctx",function(){var a=s.Ctx;a&&a.close&&(he(a),s.Ctx=0);var o=s.NewCtxs;s.NewCtxs=[];for(var i=0;i<o.length;i++)he(o[i])})),r&&e.close&&(n||(e._useC||he(e),e=new t),e._useC=1,s.NewCtxs.push(e)),e},s.CloseNewCtx=function(r){if(r&&r.close){he(r);for(var t=s.NewCtxs||[],e=t.length,n=0;n<t.length;n++)if(t[n]==r){t.splice(n,1);break}L(f("mSxV::剩{1}个GetContext未close",0,e+"-1="+t.length),t.length?3:0)}};var he=function(r){if(r&&r.close&&!r._isC&&(r._isC=1,r.state!="closed"))try{r.close()}catch(t){L("ctx close err",1,t)}},xe=s.ResumeCtx=function(r,t,e,n){var a=0,o=0,i=0,d=0,u="EventListener",v="ResumeCtx ",S=function(_,l){o&&D(),a||(a=1,_&&n(_,d),l&&e(d)),l&&(!r._LsSC&&r["add"+u]&&r["add"+u]("statechange",p),r._LsSC=1,i=1)},D=function(_){if(!(_&&o)){o=_?1:0;for(var l=["focus","mousedown","mouseup","touchstart","touchend"],T=0;T<l.length;T++)window[(_?"add":"remove")+u](l[T],p,!0)}},p=function(){var _=r.state,l=Se(_);if(!a&&!t(l?++d:d))return S();l?(i&&L(v+"sc "+_,3),D(1),r.resume().then(function(){i&&L(v+"sc "+r.state),S(0,1)})[me](function(T){L(v+"error",1,T),Se(r.state)||S(T.message||"error")})):_=="closed"?(i&&!r._isC&&L(v+"sc "+_,1),S("ctx closed")):S(0,1)};p()},Se=s.CtxSpEnd=function(r){return r=="suspended"||r=="interrupted"},Me=function(r){var t=r.state,e="ctx.state="+t;return Se(t)&&(e+=f("nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）")),e},we="ConnectEnableWebM";s[we]=!0;var ue="ConnectEnableWorklet";s[ue]=!1;var Te=function(r){var t=r.BufferSize||s.BufferSize,e=r.Stream,n=e._c,a=n[F],o={},i=be(e),d=i[0],u=null,v="";if(d&&d.getSettings){u=d.getSettings();var S=u[F];S&&S!=a&&(v=f("eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，",0,S,a))}e._ts=u,L(v+"Stream TrackSet: "+ee(u),v?3:0);var D=function(b){var M=e._m=n.createMediaStreamSource(e),I=n.destination,G="createMediaStreamDestination";n[G]&&(I=e._d=n[G]()),M.connect(b),b.connect(I)},p,_,l,T="",k=e._call,C=function(b,M){for(var I in k){if(M!=a){o.index=0,o=s.SampleData([b],M,a,o,{_sum:1});var G=o.data,N=o._sum}else{o={};for(var A=b.length,G=new Int16Array(A),N=0,U=0;U<A;U++){var P=Math.max(-1,Math.min(1,b[U]));P=P<0?P*32768:P*32767,G[U]=P,N+=Math.abs(P)}}for(var W in k)k[W](G,N);return}},h="ScriptProcessor",x="audioWorklet",w=H+" "+x,z="RecProc",y="MediaRecorder",B=y+".WebM.PCM",g=n.createScriptProcessor||n.createJavaScriptNode,m=f("ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。",0,x),c=function(){_=e.isWorklet=!1,ke(e),L(f("7TU0::Connect采用老的{1}，",0,h)+j.get(s[ue]?f("JwCL::但已设置{1}尝试启用{2}",2):f("VGjB::可设置{1}尝试启用{2}",2),[H+"."+ue+"=true",x])+T+m,3);var b=e._p=g.call(n,t,1,1);D(b),b.onaudioprocess=function(M){var I=M.inputBuffer.getChannelData(0);C(I,a)}},R=function(){p=e.isWebM=!1,Ie(e),_=e.isWorklet=!g||s[ue];var b=window.AudioWorkletNode;if(!(_&&n[x]&&b)){c();return}var M=function(){var U=function(W){return W.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,w)},P="class "+z+" extends AudioWorkletProcessor{";return P+="constructor "+U(function(W){DEL_super(W);var J=this,O=W.processorOptions.bufferSize;J.bufferSize=O,J.buffer=new Float32Array(O*2),J.pos=0,J.port.onmessage=function($){$.data.kill&&(J.kill=!0,$C.log("$RA kill call"))},$C.log("$RA .ctor call",W)}),P+="process "+U(function(W,J,O){var $=this,fe=$.bufferSize,re=$.buffer,te=$.pos;if(W=(W[0]||[])[0]||[],W.length){re.set(W,te),te+=W.length;var ae=~~(te/fe)*fe;if(ae){this.port.postMessage({val:re.slice(0,ae)});var ge=re.subarray(ae,te);re=new Float32Array(fe*2),re.set(ge),te=ge.length,$.buffer=re}$.pos=te}return!$.kill}),P+='}try{registerProcessor("'+z+'", '+z+')}catch(e){$C.error("'+w+' Reg Error",e)}',P=P.replace(/\$C\./g,"console."),"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(P)))},I=function(){return _&&e._na},G=e._na=function(){l!==""&&(clearTimeout(l),l=setTimeout(function(){l=0,I()&&(L(f("MxX1::{1}未返回任何音频，恢复使用{2}",0,x,h),3),g&&c())},500))},N=function(){if(I()){var U=e._n=new b(n,z,{processorOptions:{bufferSize:t}});D(U),U.port.onmessage=function(P){l&&(clearTimeout(l),l=""),I()?C(P.data.val,a):_||L(f("XUap::{1}多余回调",0,x),3)},L(f("yOta::Connect采用{1}，设置{2}可恢复老式{3}",0,x,H+"."+ue+"=false",h)+T+m,3)}},A=function(){if(I()){if(n[z]){N();return}var U=M();n[x].addModule(U).then(function(P){I()&&(n[z]=1,N(),l&&G())})[me](function(P){L(x+".addModule Error",1,P),I()&&c()})}};xe(n,function(){return I()},A,A)},E=function(){var b=window[y],M="ondataavailable",I="audio/webm; codecs=pcm";p=e.isWebM=s[we];var G=b&&M in b.prototype&&b.isTypeSupported(I);if(T=G?"":f("VwPd::（此浏览器不支持{1}）",0,B),!p||!G){R();return}var N=function(){return p&&e._ra};e._ra=function(){l!==""&&(clearTimeout(l),l=setTimeout(function(){N()&&(L(f("vHnb::{1}未返回任何音频，降级使用{2}",0,y,x),3),R())},500))};var A=Object.assign({mimeType:I},s.ConnectWebMOptions),U=e._r=new b(e,A),P=e._rd={};U[M]=function(W){var J=new FileReader;J.onloadend=function(){if(N()){var O=Be(new Uint8Array(J.result),P);if(!O)return;if(O==-1){R();return}l&&(clearTimeout(l),l=""),C(O,P.webmSR)}else p||L(f("O9P7::{1}多余回调",0,y),3)},J.readAsArrayBuffer(W.data)};try{U.start(~~(t/48)),L(f("LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}",0,B,H+"."+we+"=false",x,h))}catch(W){L("mr start err",1,W),R()}};E()},Le=function(r){r._na&&r._na(),r._ra&&r._ra()},ke=function(r){r._na=null,r._n&&(r._n.port.postMessage({kill:!0}),r._n.disconnect(),r._n=null)},Ie=function(r){if(r._ra=null,r._r){try{r._r.stop()}catch(t){L("mr stop err",1,t)}r._r=null}},ve=function(r){r=r||s;var t=r==s,e=r.Stream;e&&(e._m&&(e._m.disconnect(),e._m=null),!e._RC&&e._c&&s.CloseNewCtx(e._c),e._RC=null,e._c=null,e._d&&(Ae(e._d.stream),e._d=null),e._p&&(e._p.disconnect(),e._p.onaudioprocess=e._p=null),ke(e),Ie(e),t&&Ae(e)),r.Stream=0},Ae=s.StopS_=function(r){for(var t=be(r),e=0;e<t.length;e++){var n=t[e];n.stop&&n.stop()}r.stop&&r.stop()},be=function(r){var t=0,e=0,n=[];r.getAudioTracks&&(t=r.getAudioTracks(),e=r.getVideoTracks()),t||(t=r.audioTracks,e=r.videoTracks);for(var a=0,o=t?t.length:0;a<o;a++)n.push(t[a]);for(var a=0,o=e?e.length:0;a<o;a++)n.push(e[a]);return n};s.SampleData=function(r,t,e,n,a){var o="SampleData";n||(n={});var i=n.index||0,d=n.offset||0,u=n.raisePrev||0,v=n.filter;if(v&&v.fn&&(v.sr&&v.sr!=t||v.srn&&v.srn!=e)&&(v=null,L(f("d48C::{1}的filter采样率变了，重设滤波",0,o),3)),!v)if(e<=t){var S=e>t*3/4?0:e/2*3/4;v={fn:S?s.IIRFilter(!0,t,S):0}}else{var S=t>e*3/4?0:t/2*3/4;v={fn:S?s.IIRFilter(!0,e,S):0}}v.sr=t,v.srn=e;var D=v.fn,p=n.frameNext||[];a||(a={});var _=a.frameSize||1;a.frameType&&(_=a.frameType=="mp3"?1152:1);var l=a._sum,T=0,k=r.length;i>k+1&&L(f("tlbC::{1}似乎传入了未重置chunk {2}",0,o,i+">"+k),3);for(var C=0,h=i;h<k;h++)C+=r[h].length;var x=t/e;if(x>1)C=Math.max(0,C-Math.floor(d)),C=Math.floor(C/x);else if(x<1){var w=1/x;C=Math.floor(C*w)}C+=p.length;for(var z=new Int16Array(C),y=0,h=0;h<p.length;h++)z[y]=p[h],y++;for(;i<k;i++){var B=r[i],g=B instanceof Float32Array,h=d,m=B.length,c=D&&D.Embed,R=0,E=0,b=0,M=0;if(x<1){for(var I=y+h,G=u,N=0;N<m;N++){var A=B[N];g&&(A=Math.max(-1,Math.min(1,A)),A=A<0?A*32768:A*32767);var U=Math.floor(I);I+=w;for(var P=Math.floor(I),W=(A-G)/(P-U),J=1;U<P;U++,J++){var O=Math.floor(G+J*W);c?(b=O,M=c.b0*b+c.b1*c.x1+c.b0*c.x2-c.a1*c.y1-c.a2*c.y2,c.x2=c.x1,c.x1=b,c.y2=c.y1,c.y1=M,O=M):O=D?D(O):O,O>32767?O=32767:O<-32768&&(O=-32768),l&&(T+=Math.abs(O)),z[U]=O,y++}G=u=A,h+=w}d=h%1;continue}for(var N=0,$=0;N<m;N++,$++){if($<m){var A=B[$];g&&(A=Math.max(-1,Math.min(1,A)),A=A<0?A*32768:A*32767),c?(b=A,M=c.b0*b+c.b1*c.x1+c.b0*c.x2-c.a1*c.y1-c.a2*c.y2,c.x2=c.x1,c.x1=b,c.y2=c.y1,c.y1=M):M=D?D(A):A}if(R=E,E=M,$==0){N--;continue}var fe=Math.floor(h);if(N==fe){var re=Math.ceil(h),te=h-fe,ae=R,ge=re<m?E:ae,se=ae+(ge-ae)*te;se>32767?se=32767:se<-32768&&(se=-32768),l&&(T+=Math.abs(se)),z[y]=se,y++,h+=x}}d=Math.max(0,h-m)}x<1&&y+1==C&&(C--,z=new Int16Array(z.buffer.slice(0,C*2))),y-1!=C&&y!=C&&L(o+" idx:"+y+" != size:"+C,3),p=null;var Ee=C%_;if(Ee>0){var Ne=(C-Ee)*2;p=new Int16Array(z.buffer.slice(Ne)),z=new Int16Array(z.buffer.slice(0,Ne))}var Pe={index:i,offset:d,raisePrev:u,filter:v,frameNext:p,sampleRate:e,data:z};return l&&(Pe._sum=T),Pe},s.IIRFilter=function(r,t,e){var n=2*Math.PI*e/t,a=Math.sin(n),o=Math.cos(n),i=a/2,d=1+i,u=-2*o/d,v=(1-i)/d;if(r)var S=(1-o)/2/d,D=(1-o)/d;else var S=(1+o)/2/d,D=-(1+o)/d;var p=0,_=0,l=0,T=0,k=0,C=function(h){return l=S*h+D*p+S*_-u*T-v*k,_=p,p=h,k=T,T=l,l};return C.Embed={x1:0,x2:0,y1:0,y2:0,b0:S,b1:D,a1:u,a2:v},C},s.PowerLevel=function(r,t){var e=r/t||0,n;return e<1251?n=Math.round(e/1250*10):n=Math.round(Math.min(100,Math.max(0,(1+Math.log(e/1e4)/Math.log(10))*100))),n},s.PowerDBFS=function(r){var t=Math.max(.1,r||0),e=32767;return t=Math.min(t,e),t=20*Math.log(t/e)/Math.log(10),Math.max(-100,Math.round(t))},s.CLog=function(r,t){if(typeof console=="object"){var e=new Date,n=("0"+e.getMinutes()).substr(-2)+":"+("0"+e.getSeconds()).substr(-2)+"."+("00"+e.getMilliseconds()).substr(-3),a=this&&this.envIn&&this.envCheck&&this.id,o=["["+n+" "+H+(a?":"+a:"")+"]"+r],i=arguments,d=s.CLog,u=2,v=d.log||console.log;for(X(t)?v=t==1?d.error||console.error:t==3?d.warn||console.warn:v:u=1;u<i.length;u++)o.push(i[u]);ze?v&&v("[IsLoser]"+o[0],o.length>1?o:""):v.apply(console,o)}};var L=function(){s.CLog.apply(this,arguments)},ze=!0;try{ze=!console.log.apply}catch{}var We=0;function Oe(r){var t=this;t.id=++We,De();var e={type:"mp3",onProcess:K};for(var n in r)e[n]=r[n];t.set=e;var a=e[Ce],o=e[F];(a&&!X(a)||o&&!X(o))&&t.CLog(f.G("IllegalArgs-1",[f("VtS4::{1}和{2}必须是数值",0,F,Ce)]),1,r),e[Ce]=+a||16,e[F]=+o||16e3,t.state=0,t._S=9,t.Sync={O:9,C:9}}s.Sync={O:9,C:9},s.prototype=Oe.prototype={CLog:L,_streamStore:function(){return this.set.sourceStream?this:s},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var r=this._streamGet();return r&&r._c},open:function(r,t){var e=this,n=e.set,a=e._streamStore(),o=0;r=r||K;var i=function(g,m){m=!!m,e.CLog(f("5tWi::录音open失败：")+g+",isUserNotAllow:"+m,1),o&&s.CloseNewCtx(o),t&&t(g,m)};e._streamTag=Y;var d=function(){e.CLog("open ok, id:"+e.id+" stream:"+e._streamTag),r(),e._SO=0},u=a.Sync,v=++u.O,S=u.C;e._O=e._O_=v,e._SO=e._S;var D=function(){if(S!=u.C||!e._O){var g=f("dFm8::open被取消");return v==u.O?e.close():g=f("VtJO::open被中断"),i(g),!0}};if(!V){i(f.G("NonBrowser-1",["open"])+f("EMJq::，可尝试使用RecordApp解决方案")+"("+pe+"/tree/master/app-support-sample)");return}var p=e.envCheck({envName:"H5",canProcess:!0});if(p){i(f("A5bm::不能录音：")+p);return}var _,l=function(){_=n.runningContext,_||(_=o=s.GetContext(!0))};if(n.sourceStream){if(e._streamTag="set.sourceStream",!s.GetContext()){i(f("1iU7::不支持此浏览器从流中获取录音"));return}l(),ve(a);var T=e.Stream=n.sourceStream;T._c=_,T._RC=n.runningContext,T._call={};try{Te(a)}catch(g){ve(a),i(f("BTW2::从流中打开录音失败：")+g.message);return}d();return}var k=function(g,m){try{window.top.a}catch{i(f("Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})",0,'allow="camera;microphone"'));return}C(1,g)&&(/Found/i.test(g)?i(m+f("jBa9::，无可用麦克风")):i(m))},C=function(g,m){if(/Permission|Allow/i.test(m))g&&i(f("gyO5::用户拒绝了录音权限"),!0);else if(window.isSecureContext===!1)g&&i(f("oWNo::浏览器禁止不安全页面录音，可开启https解决"));else return 1};if(s.IsOpen()){d();return}if(!s.Support()){k("",f("COxc::此浏览器不支持录音"));return}l();var h=function(g){setTimeout(function(){g._call={};var m=s.Stream;m&&(ve(),g._call=m._call),s.Stream=g,g._c=_,g._RC=n.runningContext,!D()&&(s.IsOpen()?(m&&e.CLog(f("upb8::发现同时多次调用open"),1),Te(a),d()):i(f("Q1GA::录音功能无效：无音频流")))},100)},x=function(g){var m=g.name||g.message||g.code+":"+g,c="";w==1&&C(0,m)&&(c=f("KxE2::，将尝试禁用回声消除后重试"));var R=f("xEQR::请求录音权限错误"),E=f("bDOG::无法录音：");e.CLog(R+c+"|"+g,c||y?3:1,g),c?(z=m,y=g,B(1)):y?(e.CLog(R+"|"+y,1,y),k(z,E+y)):k(m,E+g)},w=0,z,y,B=function(g){w++;var m="audioTrackSet",c="autoGainControl",R="echoCancellation",E="noiseSuppression",b=m+":{"+R+","+E+","+c+"}",M=JSON.parse(ee(n[m]||!0));e.CLog("open... "+w+" "+m+":"+ee(M)),g&&(typeof M!="object"&&(M={}),M[c]=!1,M[R]=!1,M[E]=!1),M[F]&&e.CLog(f("IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象",0,m+"."+F),3);var I={audio:M,video:n.videoTrackSet||!1};try{var G=s.Scope[Y](I,h,x)}catch(N){e.CLog(Y,3,N),I={audio:!0,video:!1},G=s.Scope[Y](I,h,x)}e.CLog(Y+"("+ee(I)+") "+Me(_)+f("RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置",0,b,m)+"("+pe+") LM:"+de+" UA:"+navigator.userAgent),G&&G.then&&G.then(h)[me](x)};B()},close:function(r){r=r||K;var t=this,e=t._streamStore();t._stop();var n=" stream:"+t._streamTag,a=e.Sync;if(t._O=0,t._O_!=a.O){t.CLog(f("hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）")+n,3),r();return}a.C++,ve(e),t.CLog("close,"+n),r()},mock:function(r,t){var e=this;return e._stop(),e.isMock=1,e.mockEnvInfo=null,e.buffers=[r],e.recSize=r.length,e._setSrcSR(t),e._streamTag="mock",e},_setSrcSR:function(r){var t=this,e=t.set,n=e[F];n>r?e[F]=r:n=0,t[le]=r,t.CLog(le+": "+r+" set."+F+": "+e[F]+(n?" "+f("UHvm::忽略")+": "+n:""),n?3:0)},envCheck:function(r){var t,e=this,n=e.set,a="CPU_BE";if(!t&&!s[a]&&typeof Int8Array=="function"&&!new Int8Array(new Int32Array([1]).buffer)[0]&&(De(a),t=f("Essp::不支持{1}架构",0,a)),!t){var o=n.type,i=e[o+"_envCheck"];n.takeoffEncodeChunk&&(i?r.canProcess||(t=f("7uMV::{1}环境不支持实时处理",0,r.envName)):t=f("2XBl::{1}类型不支持设置takeoffEncodeChunk",0,o)+(e[o]?"":f("LG7e::(未加载编码器)"))),!t&&i&&(t=e[o+"_envCheck"](r,n))}return t||""},envStart:function(r,t){var e=this,n=e.set;if(e.isMock=r?1:0,e.mockEnvInfo=r,e.buffers=[],e.recSize=0,r&&(e._streamTag="env$"+r.envName),e.state=1,e.envInLast=0,e.envInFirst=0,e.envInFix=0,e.envInFixTs=[],e._setSrcSR(t),e.engineCtx=0,e[n.type+"_start"]){var a=e.engineCtx=e[n.type+"_start"](n);a&&(a.pcmDatas=[],a.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(r,t){var e=this,n=e.set,a=e.engineCtx;if(e.state!=1){e.state||e.CLog("envIn at state=0",3);return}var o=e[le],i=r.length,d=s.PowerLevel(t,i),u=e.buffers,v=u.length;u.push(r);var S=u,D=v,p=Date.now(),_=Math.round(i/o*1e3);e.envInLast=p,e.buffers.length==1&&(e.envInFirst=p-_);var l=e.envInFixTs;l.splice(0,0,{t:p,d:_});for(var T=p,k=0,C=0;C<l.length;C++){var h=l[C];if(p-h.t>3e3){l.length=C;break}T=h.t,k+=h.d}var x=l[1],w=p-T,z=w-k;if(z>w/3&&(x&&w>1e3||l.length>=6)){var y=p-x.t-_;if(y>_/5){var B=!n.disableEnvInFix;if(e.CLog("["+p+"]"+j.get(f(B?"4Kfd::补偿{1}ms":"bM5i::未补偿{1}ms",1),[y]),3),e.envInFix+=y,B){var g=new Int16Array(y*o/1e3);i+=g.length,u.push(g)}}}var m=e.recSize,c=i,R=m+c;if(e.recSize=R,a){var E=s.SampleData(u,o,n[F],a.chunkInfo);a.chunkInfo=E,m=a.pcmSize,c=E.data.length,R=m+c,a.pcmSize=R,u=a.pcmDatas,v=u.length,u.push(E.data),o=E[F]}var b=Math.round(R/o*1e3),M=u.length,I=S.length,G=function(){for(var W=N?0:-c,J=u[0]==null,O=v;O<M;O++){var $=u[O];$==null?J=1:(W+=$.length,a&&$.length&&e[n.type+"_encode"](a,$))}if(J&&a){var O=D;for(S[0]&&(O=0);O<I;O++)S[O]=null}J&&(W=N?c:0,u[0]=null),a?a.pcmSize+=W:e.recSize+=W},N=0,A="rec.set.onProcess";try{N=n.onProcess(u,d,b,o,v,G),N=N===!0}catch(W){console.error(A+f("gFUF::回调出错是不允许的，需保证不会抛异常"),W)}var U=Date.now()-p;if(U>10&&e.envInFirst-p>1e3&&e.CLog(A+f("2ghS::低性能，耗时{1}ms",0,U),3),N){for(var P=0,C=v;C<M;C++)u[C]==null?P=1:u[C]=new Int16Array(0);P?e.CLog(f("ufqH::未进入异步前不能清除buffers"),3):a?a.pcmSize-=c:e.recSize-=c}else G()},start:function(){var r=this,t=1;if(r.set.sourceStream?r.Stream||(t=0):s.IsOpen()||(t=0),!t){r.CLog(f("6WmN::start失败：未open"),1);return}var e=r._streamCtx();if(r.CLog(f("kLDN::start 开始录音，")+Me(e)+" stream:"+r._streamTag),r._stop(),r.envStart(null,e[F]),r.state=3,r._SO&&r._SO+1!=r._S){r.CLog(f("Bp2y::start被中断"),3);return}r._SO=0;var n=function(){r.state==3&&(r.state=1,r.resume())},a="AudioContext resume: ",o=r._streamGet();o._call[r.id]=function(){r.CLog(a+e.state+"|stream ok"),n()},xe(e,function(i){return i&&r.CLog(a+"wait..."),r.state==3},function(i){i&&r.CLog(a+e.state),n()},function(i){r.CLog(a+e.state+f("upkE::，可能无法录音：")+i,1),n()})},pause:function(){var r=this,t=r._streamGet();r.state&&(r.state=2,r.CLog("pause"),t&&delete t._call[r.id])},resume:function(){var r=this,t=r._streamGet(),e="resume",n=e+"(wait ctx)";if(r.state==3)r.CLog(n);else if(r.state){r.state=1,r.CLog(e),r.envResume(),t&&(t._call[r.id]=function(o,i){r.state==1&&r.envIn(o,i)},Le(t));var a=r._streamCtx();a&&xe(a,function(o){return o&&r.CLog(n+"..."),r.state==1},function(o){o&&r.CLog(n+a.state),Le(t)},function(o){r.CLog(n+a.state+"[err]"+o,1)})}},_stop:function(r){var t=this,e=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!r&&t[e.type+"_stop"]&&(t[e.type+"_stop"](t.engineCtx),t.engineCtx=0)},stop:function(r,t,e){var n=this,a=n.set,o,i=n.envInLast-n.envInFirst,d=i&&n.buffers.length;n.CLog(f("Xq4s::stop 和start时差:")+(i?i+"ms "+f("3CQP::补偿:")+n.envInFix+"ms envIn:"+d+" fps:"+(d/i*1e3).toFixed(1):"-")+" stream:"+n._streamTag+" ("+pe+") LM:"+de);var u=function(){n._stop(),e&&n.close()},v=function(h){n.CLog(f("u8JG::结束录音失败：")+h,1),t&&t(h),u()},S=function(h,x,w){var z="blob",y="arraybuffer",B="dataType",g="DefaultDataType",m=n[B]||s[g]||z,c=B+"="+m,R=h instanceof ArrayBuffer,E=0,b=R?h.byteLength:h.size;if(m==y?R||(E=1):m==z?typeof Blob!="function"?E=f.G("NonBrowser-1",[c])+f("1skY::，请设置{1}",0,H+"."+g+'="'+y+'"'):(R&&(h=new Blob([h],{type:x})),h instanceof Blob||(E=1),x=h.type||x):E=f.G("NotSupport-1",[c]),n.CLog(f("Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b",0,Date.now()-o,w,b)+" "+c+","+x),E){v(E!=1?E:f("Vkbd::{1}编码器返回的不是{2}",0,a.type,m)+", "+c);return}if(a.takeoffEncodeChunk)n.CLog(f("QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据"),3);else if(b<Math.max(50,w/5)){v(f("Sz2H::生成的{1}无效",0,a.type));return}r&&r(h,w,x),u()};if(!n.isMock){var D=n.state==3;if(!n.state||D){v(f("wf9t::未开始录音")+(D?f("Dl2c::，开始录音前无用户交互导致AudioContext未运行"):""));return}}n._stop(!0);var p=n.recSize;if(!p){v(f("Ltz3::未采集到录音"));return}if(!n[a.type]){v(f("xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载",0,a.type,H));return}if(n.isMock){var _=n.envCheck(n.mockEnvInfo||{envName:"mock",canProcess:!1});if(_){v(f("AxOH::录音错误：")+_);return}}var l=n.engineCtx;if(n[a.type+"_complete"]&&l){var C=Math.round(l.pcmSize/a[F]*1e3);o=Date.now(),n[a.type+"_complete"](l,function(x,w){S(x,w,C)},v);return}if(o=Date.now(),!n.buffers[0]){v(f("xkKd::音频buffers被释放"));return}var T=s.SampleData(n.buffers,n[le],a[F]);a[F]=T[F];var k=T.data,C=Math.round(k.length/a[F]*1e3);n.CLog(f("CxeT::采样:{1} 花:{2}ms",0,p+"->"+k.length,Date.now()-o)),setTimeout(function(){o=Date.now(),n[a.type](k,function(h,x){S(h,x,C)},function(h){v(h)})})}};var Be=function(r,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var e=t.tracks,n=[t.pos[0]],a=function(){t.pos[0]=n[0]},o=t.bytes.length,i=new Uint8Array(o+r.length);if(i.set(t.bytes),i.set(r,o),t.bytes=i,!t._ht){if(Z(i,n),oe(i,n),!Q(Z(i,n),[24,83,128,103]))return;for(Z(i,n);n[0]<i.length;){var d=Z(i,n),u=oe(i,n),v=[0],S=0;if(!u)return;if(Q(d,[22,84,174,107])){for(;v[0]<u.length;){var D=Z(u,v),p=oe(u,v),_=[0],l={channels:0,sampleRate:0};if(Q(D,[174]))for(;_[0]<p.length;){var T=Z(p,_),k=oe(p,_),C=[0];if(Q(T,[215])){var h=ce(k);l.number=h,e[h]=l}else if(Q(T,[131])){var h=ce(k);h==1?l.type="video":h==2?(l.type="audio",S||(t.track0=l),l.idx=S++):l.type="Type-"+h}else if(Q(T,[134])){for(var x="",w=0;w<k.length;w++)x+=String.fromCharCode(k[w]);l.codec=x}else if(Q(T,[225]))for(;C[0]<k.length;){var z=Z(k,C),y=oe(k,C);if(Q(z,[181])){var h=0,B=new Uint8Array(y.reverse()).buffer;y.length==4?h=new Float32Array(B)[0]:y.length==8?h=new Float64Array(B)[0]:L("WebM Track !Float",1,y),l[F]=Math.round(h)}else Q(z,[98,100])?l.bitDepth=ce(y):Q(z,[159])&&(l.channels=ce(y))}}}t._ht=1,L("WebM Tracks",e),a();break}}}var g=t.track0;if(g){var m=g[F];if(t.webmSR=m,g.bitDepth==16&&/FLOAT/i.test(g.codec)&&(g.bitDepth=32,L("WebM 16->32 bit",3)),m<8e3||g.bitDepth!=32||g.channels<1||!/(\b|_)PCM\b/i.test(g.codec))return t.bytes=[],t.bad||L("WebM Track Unexpected",3,t),t.bad=1,-1;for(var c=[],R=0;n[0]<i.length;){var D=Z(i,n),p=oe(i,n);if(!p)break;if(Q(D,[163])){var E=p[0]&15,l=e[E];if(l){if(l.idx===0){for(var b=new Uint8Array(p.length-4),w=4;w<p.length;w++)b[w-4]=p[w];c.push(b),R+=b.length}}else return L("WebM !Track"+E,1,e),-1}a()}if(R){var M=new Uint8Array(i.length-t.pos[0]);M.set(i.subarray(t.pos[0])),t.bytes=M,t.pos[0]=0;for(var b=new Uint8Array(R),w=0,I=0;w<c.length;w++)b.set(c[w],I),I+=c[w].length;var B=new Float32Array(b.buffer);if(g.channels>1){for(var G=[],w=0;w<B.length;)G.push(B[w]),w+=g.channels;B=new Float32Array(G)}return B}}},Q=function(r,t){if(!r||r.length!=t.length)return!1;if(r.length==1)return r[0]==t[0];for(var e=0;e<r.length;e++)if(r[e]!=t[e])return!1;return!0},ce=function(r){for(var t="",e=0;e<r.length;e++){var n=r[e];t+=(n<16?"0":"")+n.toString(16)}return parseInt(t,16)||0},Z=function(r,t,e){var n=t[0];if(!(n>=r.length)){var a=r[n],o=("0000000"+a.toString(2)).substr(-8),i=/^(0*1)(\d*)$/.exec(o);if(i){var d=i[1].length,u=[];if(!(n+d>r.length)){for(var v=0;v<d;v++)u[v]=r[n],n++;return e&&(u[0]=parseInt(i[2]||"0",2)),t[0]=n,u}}}},oe=function(r,t){var e=Z(r,t,1);if(e){var n=ce(e),a=t[0],o=[];if(n<2147483647){if(a+n>r.length)return;for(var i=0;i<n;i++)o[i]=r[a],a++}return t[0]=a,o}},j=s.i18n={lang:"zh-CN",alias:{"zh-CN":"zh","en-US":"en"},locales:{},data:{},put:function(r,t){var e=H+".i18n.put: ",n=r.overwrite;n=n==null||n;var a=r.lang;if(a=j.alias[a]||a,!a)throw new Error(e+"set.lang?");var o=j.locales[a];o||(o={},j.locales[a]=o);for(var i=/^([\w\-]+):/,d,u=0;u<t.length;u++){var S=t[u];if(d=i.exec(S),!d){L(e+"'key:'? "+S,3,r);continue}var v=d[1],S=S.substr(v.length+1);!n&&o[v]||(o[v]=S)}},get:function(){return j.v_G.apply(null,arguments)},v_G:function(r,t,e){t=t||[],e=e||j.lang,e=j.alias[e]||e;var n=j.locales[e],a=n&&n[r]||"";return!a&&e!="zh"?e=="en"?j.v_G(r,t,"zh"):j.v_G(r,t,"en"):(j.lastLang=e,a=="=Empty"?"":a.replace(/\{(\d+)(\!?)\}/g,function(o,i,d){return i=+i||0,o=t[i-1],(i<1||i>t.length)&&(o="{?}",L("i18n["+r+"] no {"+i+"}: "+a,3)),d?"":o}))},$T:function(){return j.v_T.apply(null,arguments)},v_T:function(){for(var r=arguments,t="",e=[],n=0,a=H+".i18n.$T:",o=/^([\w\-]*):/,i,d=0;d<r.length;d++){var u=r[d];if(d==0){if(i=o.exec(u),t=i&&i[1],!t)throw new Error(a+"0 'key:'?");u=u.substr(t.length+1)}if(n===-1)e.push(u);else{if(n)throw new Error(a+" bad args");if(u===0)n=-1;else if(X(u)){if(u<1)throw new Error(a+" bad args");n=u}else{var v=d==1?"en":d?"":"zh";if(i=o.exec(u),i&&(v=i[1]||v,u=u.substr(i[1].length+1)),!i||!v)throw new Error(a+d+" 'lang:'?");j.put({lang:v,overwrite:!1},[t+":"+u])}}}return t?n>0?t:j.v_G(t,e):""}},f=j.$T;f.G=j.get,f("NonBrowser-1::非浏览器环境，不支持{1}",1),f("IllegalArgs-1::参数错误：{1}",1),f("NeedImport-2::调用{1}需要先导入{2}",2),f("NotSupport-1::不支持：{1}",1),s.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var De=s.Traffic=function(r){if(V){r=r?"/"+H+"/Report/"+r:"";var t=s.TrafficImgUrl;if(t){var e=s.Traffic,n=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],a=n[1]||"http://file/",o=(n[0]||a)+r;if(t.indexOf("//")==0&&(/^https:/i.test(o)?t="https:"+t:t="http:"+t),r&&(t=t+"&cu="+encodeURIComponent(a+r)),!e[o]){e[o]=1;var i=new Image;i.src=t,L("Traffic Analysis Image: "+(r||H+".TrafficImgUrl="+s.TrafficImgUrl))}}}};ie&&(L(f("8HO5::覆盖导入{1}",0,H),1),ie.Destroy()),ne[H]=s})}(ye)),ye.exports}var Ge=$e();const je=Fe(Ge),Je=Ue({__proto__:null,default:je},[Ge]);export{Je as r};
