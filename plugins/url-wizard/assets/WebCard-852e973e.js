import{K as z,P as B,Q as D,O as $,L as K,T as L,R}from"./index-4d792b2f.js";import{E as V}from"./avatar-013be683.js";import{f as j,ag as q,K as w,c as d,r as F,h as m,i as p,k as i,W as H,U as O,a9 as P,t as y,u as r,n as Q,a2 as U,l as C,j as A,v as G,m as J,ad as X}from"./vue-5f6c84d3.js";import{u as Y}from"./useNoteStore-185ebad8.js";import{E as Z}from"./index-425c5bd9.js";const ee={class:"flex-y-center"},te={class:"overflow-hidden"},oe={class:"flex-y-center"},se={key:0,class:"mr-6px"},ne=["innerHTML"],ae=["title"],ce={key:0,class:"iconfont text-13px icon-remarks mr-1"},ie={class:"text-12px truncate"},re=j({__name:"WebCard",props:{web:{},catId:{}},setup(l){const e=l,n=z(),a=B(),u=Y(),{openLink:k}=D(),{category:g}=q($()),f=w("showWebModal"),x=w("showNoteModal"),_=w("searchKeyWord"),I=d(()=>e.web.url.includes("{q}")),W=d(()=>e.web.icon.data?e.web.icon.data:K(e.web.url)),S=d(()=>e.web.icon.type=="image"?{backgroundColor:e.web.icon.imageColor}:{backgroundColor:e.web.icon.textColor,fontSize:`${e.web.icon.fontSize}px`,fontWeight:500}),M=()=>{x.value=!0,u.setCurrNote(e.web)},h=F(""),b=d(()=>e.web.catIds.includes("cat@dustbin"));function T(t){t.preventDefault(),L.showContextMenu({x:t.x,y:t.y,zIndex:1020,items:[{label:"追加",icon:"icon-add-circle",disabled:!e.catId.startsWith("cat_"),onClick:()=>{a.getEcatId(e.catId),a.getTheId(e.web._id),a.changeEditMode("append"),f.value=!0}},{label:"编辑",icon:"icon-edit",disabled:b.value,divided:!0,onClick:()=>{a.getEcatId(e.catId),a.getTheId(e.web._id),a.changeEditMode("edit"),f.value=!0}},{label:e.web.isFly?"取消快开":"网页快开",icon:e.web.isFly?"icon-quick-fill":"icon-quick",disabled:b.value,divided:!0,onClick:()=>{n.fly(X(e.web))}},{label:"复制链接",icon:"icon-remarks",onClick:()=>{let o=e.web.url;e.web.urls&&e.web.urls.length>0&&(o=o+`
`+e.web.urls.map(c=>c.value).join(`
`)),utools.copyText(o)}},{label:"移到...",icon:"icon-move",disabled:e.catId=="cat@search"||e.catId=="cat@fly",children:g.value.map(o=>{const c=o.children.map(s=>({label:s.label,disabled:e.web.catIds.includes(s._id),onClick:()=>{n.moveWeb(e.web._id,e.catId,s._id)}}));return{label:o.label,disabled:e.web.catIds.includes(o._id),children:c,onClick:()=>{n.moveWeb(e.web._id,e.catId,o._id)}}})},{label:b.value||e.catId=="cat@search"?"删除":"移除",icon:"icon-delete",disabled:e.catId=="cat@fly",onClick:()=>{e.web.hasNote?N().then(o=>{v()}).catch(o=>{}):v()}}]})}const v=()=>{if(h.value="remove-web",e.catId=="cat@search"){const t=utools.db.get(e.web._id);setTimeout(()=>{n.forceDelWeb(t)},350);return}setTimeout(()=>{n.removeWeb(e.web._id,e.catId)},350)},N=()=>new Promise((t,o)=>{Z.confirm("该卡片有笔记，确定要删除吗？",{confirmButtonText:"删除",cancelButtonText:"取消",autofocus:!1,center:!0}).then(()=>{t(!0)}).catch(()=>{o(!1)})}),E=t=>{if(!_.value)return t;const o=R.match(t,_.value);if(typeof o=="boolean")return t;const[c,s]=o;return`${t.slice(0,c)}<span class="text-primary">${t.slice(c,s+1)}</span>${t.slice(s+1)}`};return(t,o)=>{const c=V;return m(),p("li",{class:J(["web-item p-4 cursor-pointer",r(h)]),onContextmenu:o[0]||(o[0]=s=>T(s)),onClick:o[1]||(o[1]=s=>r(k)(t.web))},[i("div",ee,[H(c,{class:"shrink-0 mr-3",size:42,src:t.web.icon.type=="image"?r(W):"",style:Q(r(S)),onClick:U(M,["stop"])},{default:O(()=>[P(y(t.web.icon.text),1)]),_:1},8,["src","style","onClick"]),i("div",te,[i("div",oe,[r(I)?(m(),p("span",se,"✦")):C("",!0),i("h3",{class:"web-title font-500 text-14px truncate",innerHTML:E(t.web.title)},null,8,ne)]),A(i("div",{class:"flex-y-center text-muted mt-0.5",title:t.web.desc},[t.web.hasNote?(m(),p("i",ce)):C("",!0),i("span",ie,y(t.web.desc),1)],8,ae),[[G,t.web.desc]])])])],34)}}});const le=(l,e)=>{const n=l.__vccOpts||l;for(const[a,u]of e)n[a]=u;return n},pe=le(re,[["__scopeId","data-v-ddc39997"]]);export{pe as _};
